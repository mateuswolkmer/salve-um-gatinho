---
export const prerender = false;
import { Button } from "../../Button";
import PageSection from "../../PageSection.astro";

// Define success/error messages
type FormStatus = {
  success?: string;
  error?: string;
};

let formStatus: FormStatus = {};

if (Astro.request.method === "POST") {
  try {
    const data = await Astro.request.formData();
    const name = data.get("name");
    const email = data.get("email");
    const subject = data.get("subject");
    const message = data.get("message");

    // Validate required fields
    if (!name || !email || !message) {
      formStatus.error = "Por favor, preencha todos os campos obrigatórios.";
    } else {
      // Process the form data (you can add your logic here)
      console.log(`name: ${name} email:${email} subject:${subject} message:${message}`);
      
      // Set success message
      formStatus.success = "Mensagem enviada com sucesso!";
    }
  } catch (error) {
    if (error instanceof Error) {
      formStatus.error = `Erro ao enviar mensagem: ${error.message}`;
      console.error(`error: ${error.message}`);
    }
  }
}
---

<PageSection title="Fale conosco">
  <div
    class="w-full max-w-xl m-auto intersect:motion-preset-slide-up intersect-once"
  >
    {formStatus.success && (
      <div class="bg-green-100 border-2 border-green-500 text-green-700 px-4 py-3 rounded-xl mb-4">
        {formStatus.success}
      </div>
    )}
    {formStatus.error && (
      <div class="bg-red-100 border-2 border-red-500 text-red-700 px-4 py-3 rounded-xl mb-4">
        {formStatus.error}
      </div>
    )}
    <form method="post" autocomplete="on" class="flex flex-col gap-2">
      <div class="flex flex-col gap-1">
        <label for="name" class="text-lg font-semibold">Nome</label>
        <input
          id="name"
          name="name"
          type="text"
          placeholder="Maria"
          required
          class="transition-all border-2 border-b-4 focus:border-b-4 focus:mb-1 transform focus:scale-[102%] border-black hover:scale-[99%] hover:shadow-lg focus:shadow-none rounded-xl p-2 text-xl"
        />
      </div>
      <div class="flex flex-col gap-1">
        <label for="email" class="text-lg font-semibold">Email</label>
        <input
          id="email"
          name="email"
          type="email"
          placeholder="maria@gmail.com"
          required
          class="transition-all border-2 border-b-4 focus:border-b-4 focus:mb-1 transform focus:scale-[102%] border-black hover:scale-[99%] hover:shadow-lg focus:shadow-none rounded-xl p-2 text-xl"
        />
      </div>
      <div class="flex flex-col gap-1">
        <label for="subject" class="text-lg font-semibold">Assunto</label>
        <input
          id="subject"
          name="subject"
          type="text"
          placeholder="Dúvida"
          class="transition-all border-2 border-b-4 focus:border-b-4 focus:mb-1 transform focus:scale-[102%] border-black hover:scale-[99%] hover:shadow-lg focus:shadow-none rounded-xl p-2 text-xl"
        />
      </div>
      <div class="flex flex-col gap-1">
        <label for="message" class="text-lg font-semibold">Mensagem</label>
        <textarea
          id="message"
          placeholder="Olá, eu gostaria de tirar uma dúvida..."
          name="message"
          required
          class="transition-all border-2 border-b-4 focus:border-b-4 focus:mb-1 transform focus:scale-[102%] border-black hover:scale-[99%] hover:shadow-lg focus:shadow-none rounded-xl p-2 text-xl"
          rows="3"></textarea>
      </div>
      <Button variant="form" class="self-center mt-4" type="submit">
        Enviar
      </Button>
    </form>
  </div>
</PageSection>
